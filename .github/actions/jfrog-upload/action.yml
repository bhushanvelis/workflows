name: "JFrog Upload Action"
description: "Upload dummy artifact to JFrog Artifactory"
inputs:
  jfrog-url:
    required: true
    type: string
  jfrog-username:
    required: true
    type: string
  jfrog-key:
    required: true
    type: string
  repo:
    required: true
    type: string
  file:
    required: true
    type: string
  target-path:
    required: true
    type: string

runs:
  using: "composite"
  steps:
    - name: Setup JFrog CLI (v2.64.0)
      shell: bash
      run: |
        curl -fL https://releases.jfrog.io/artifactory/jfrog-cli/v2-jf/2.64.0/jfrog-cli-linux-amd64/jf -o jf
        chmod +x jf
        sudo mv jf /usr/local/bin/
        jf --version



    - name: Configure JFrog CLI
      shell: bash
      run: |
        echo "üîß Configuring JFrog CLI..."
        jf c show || true
        jf c remove my-server || true
        jfrog c add my-server \
          --artifactory-url "${{ inputs.jfrog-url }}" \
          --user "${{ inputs.jfrog-username }}" \
          --password "${{ inputs.jfrog-key }}" \
          --interactive=false \
          --overwrite \
          --basic-auth-only=true \
          --enc-password=false

    - name: Test JFrog Connection
      shell: bash
      run: |
        echo "üîç Pinging Artifactory..."
        jf rt ping --server-id=my-server
        jf c show my-server

    - name: Upload Artifact
      shell: bash
      run: |
        echo "‚¨ÜÔ∏è Uploading file: ${{ inputs.file }} ‚Üí ${{ inputs.repo }}/${{ inputs.target-path }}/"
        jf rt u "${{ inputs.file }}" "${{ inputs.target-path }}" --server-id=my-server
